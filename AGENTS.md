# AGENTS.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

Hyperfanity is a GPU-accelerated vanity address generator supporting TRX, ETH, SOL, and BTC. It uses CUDA kernels for parallel key generation and pattern matching.

## Build Commands

```bash
# Configure (from repo root)
cmake -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=ON

# Build
cmake --build build -j$(nproc)

# Build with specific CUDA architectures
cmake -B build -DCMAKE_CUDA_ARCHITECTURES="80;86;89"
```

## Running

```bash
# Standalone CLI
./build/hyperfanity --chain eth --prefix dead
./build/hyperfanity --chain trx --suffix 8888
./build/hyperfanity --chain sol --prefix Abc
./build/hyperfanity --chain btc --prefix dead
./build/hyperfanity --benchmark --chain eth
```

## Tests

Requires GTest. Tests run on CUDA hardware.

```bash
# Run all tests
cd build && ctest --output-on-failure

# Run single test
./build/test_secp256k1
./build/test_ed25519
./build/test_keccak
```

## Docker

```bash
# Build worker (CUDA)
docker build -f Dockerfile.worker -t hyperfanity-worker .

# Build panel (Go gRPC server)
docker build -f Dockerfile.panel -t hyperfanity-panel .

# Run tests in Docker
docker build -f Dockerfile.worker --target test -t hyperfanity-test .
docker run --gpus all hyperfanity-test

# Run worker
docker run --gpus all hyperfanity-worker --chain btc --prefix dead
```

## Architecture

### Curve Pipelines

- **secp256k1**: Used for ETH, TRX, BTC. Kernels in `kernels/secp256k1/`.
- **Ed25519**: Used for SOL. Kernels in `kernels/ed25519/`.

### Key Components

- `src/dispatch/dispatcher.cpp`: Orchestrates GPU kernel launches, manages per-device state, runs mining loop
- `kernels/common/mp_uint256.cuh`: 256-bit multiprecision arithmetic (mod secp256k1 prime)
- `kernels/common/keccak.cuh`: Keccak-256 for ETH/TRX address derivation
- `kernels/ed25519/fe25519.cuh`: Field arithmetic mod 2^255-19 (5-limb radix-2^51)
- `kernels/ed25519/ge25519.cuh`: Ed25519 group operations (extended coordinates)
- `src/scoring/scorer.hpp`: Pattern matching modes (prefix, suffix, anywhere, benchmark)
- `src/chain/`: Address encoding per chain (Base58Check for TRX, EIP-55 for ETH, Base58 for SOL)

### Panel (Go gRPC Server)

Located in `panel/`. Coordinates distributed workers via gRPC.

- `panel/main.go`: Entry point, starts gRPC (port 50051) and HTTP (port 8080)
- `panel/job_manager.go`: Job queue and worker registry
- `panel/api.go`: gRPC service implementation
- `proto/hyperfanity.proto`: Protocol definition

Regenerate protobuf stubs:
```bash
protoc --go_out=panel/pb --go-grpc_out=panel/pb proto/hyperfanity.proto
```

### Kernel Pipeline (secp256k1)

1. `secp256k1_init.cu`: Initialize points from random seeds using precomputed table
2. `secp256k1_inverse.cu`: Batch modular inverse (Algorithm 2.11)
3. `secp256k1_iterate.cu`: Iterative point addition + Keccak hash → 20-byte address

### Kernel Pipeline (Ed25519)

1. `ed25519_keygen.cu`: seed → SHA-512 → clamp → scalar × B → compressed pubkey
2. `ed25519_inverse.cu`: Batch inverse over fe25519
3. `ed25519_iterate.cu`: Iterative base-point addition → 32-byte pubkey

## Code Conventions

- CUDA device code uses `__host__ __device__` macro `HD` from `types.hpp`
- 256-bit numbers stored as 8×32-bit words, little-endian (`mp_number`)
- Precomputed tables generated by Python scripts in `tools/`
